<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Zeb11 Notepad + Terminal</title>
  <style>
    :root {
      --bg: #ffffff;
      --fg: #000000;
      --accent: #0078d7;
    }
    [data-theme="dark"] {
      --bg: #1e1e1e;
      --fg: #ffffff;
      --accent: #0a84ff;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--fg);
      display: flex;
      height: 100vh;
      flex-direction: column;
    }
    #toolbar {
      background: var(--accent);
      color: white;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #main {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    textarea, iframe, #terminal {
      font-size: 14px;
      font-family: monospace;
      background: var(--bg);
      color: var(--fg);
      border: none;
      padding: 10px;
      resize: none;
      outline: none;
    }
    textarea {
      width: 50%;
      height: 100%;
    }
    #rightPane {
      display: flex;
      flex-direction: column;
      width: 50%;
    }
    #terminal {
      height: 50%;
      border-top: 1px solid #ccc;
      overflow-y: auto;
    }
    iframe {
      height: 50%;
      border-top: 1px solid #ccc;
      width: 100%;
    }
    button {
      background: white;
      color: var(--accent);
      border: none;
      padding: 5px 10px;
      margin-left: 5px;
      cursor: pointer;
      border-radius: 3px;
    }
  </style>
</head>
<body data-theme="light">
  <div id="toolbar">
    <span>Zeb11 Editor + Terminal</span>
    <div>
      <button onclick="toggleTheme()">Toggle Theme</button>
      <button onclick="saveFile()">Save</button>
      <button onclick="runPreview()">Run</button>
    </div>
  </div>

  <div id="main">
    <textarea id="editor" placeholder="Write HTML/JS here..."></textarea>
    <div id="rightPane">
      <iframe id="preview"></iframe>
      <div id="terminal" contenteditable="true"></div>
    </div>
  </div>

  <script>
    const editor = document.getElementById("editor");
    const terminal = document.getElementById("terminal");
    const preview = document.getElementById("preview");
    let commandHistory = [];
    let historyIndex = -1;

    // Toggle dark/light mode
    function toggleTheme() {
      const body = document.body;
      const isDark = body.getAttribute("data-theme") === "dark";
      body.setAttribute("data-theme", isDark ? "light" : "dark");
    }

    // Run HTML/JS in preview pane
    function runPreview() {
      const code = editor.value;
      preview.srcdoc = code;
    }

    // Save to IndexedDB
    function saveFile() {
      const dbReq = indexedDB.open("ZebFS", 1);
      dbReq.onupgradeneeded = () => {
        const db = dbReq.result;
        if (!db.objectStoreNames.contains("files")) {
          db.createObjectStore("files");
        }
      };
      dbReq.onsuccess = () => {
        const db = dbReq.result;
        const tx = db.transaction("files", "readwrite");
        const store = tx.objectStore("files");
        store.put(editor.value, "index.html");
        alert("Saved to ZebFS!");
      };
    }

    // Load from IndexedDB
    window.onload = () => {
      const dbReq = indexedDB.open("ZebFS", 1);
      dbReq.onsuccess = () => {
        const db = dbReq.result;
        const tx = db.transaction("files", "readonly");
        const store = tx.objectStore("files");
        const getReq = store.get("index.html");
        getReq.onsuccess = () => {
          if (getReq.result) {
            editor.value = getReq.result;
          }
        };
      };
    };

    // Handle terminal input with command history
    terminal.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        const lines = terminal.innerText.trim().split("\n");
        const command = lines[lines.length - 1];
        commandHistory.push(command);
        historyIndex = commandHistory.length;
        processCommand(command);
      } else if (e.key === "ArrowUp") {
        e.preventDefault();
        if (historyIndex > 0) {
          historyIndex--;
          insertCommand(commandHistory[historyIndex]);
        }
      } else if (e.key === "ArrowDown") {
        e.preventDefault();
        if (historyIndex < commandHistory.length - 1) {
          historyIndex++;
          insertCommand(commandHistory[historyIndex]);
        }
      }
    });

    function insertCommand(cmd) {
      const lines = terminal.innerText.split("\n");
      lines[lines.length - 1] = cmd;
      terminal.innerText = lines.join("\n");
      placeCursorAtEnd(terminal);
    }

    function placeCursorAtEnd(el) {
      const range = document.createRange();
      const sel = window.getSelection();
      range.selectNodeContents(el);
      range.collapse(false);
      sel.removeAllRanges();
      sel.addRange(range);
    }

    function processCommand(cmd) {
      const output = `\n> ${cmd}\n${evalSafe(cmd)}\n`;
      terminal.innerText += output;
      placeCursorAtEnd(terminal);
    }

    function evalSafe(code) {
      try {
        return eval(code);
      } catch (e) {
        return "Error: " + e.message;
      }
    }
  </script>
</body>
</html>
